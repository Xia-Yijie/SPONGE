name: build SPONGE on Windows 
on:
  push

jobs:
  build:
    name: build-${{ matrix.vcuda }}
    runs-on: windows-latest
    strategy: 
      fail-fast: true
      matrix:
        include:
          - vcuda_full: 11.7.0
            vcuda: 11.7
            vs_url: https://download.visualstudio.microsoft.com/download/pr/6d7709aa-465b-4604-b797-3f9c1d911e67/c4cbd4106b2b6ebd5e88e75d025b0ecbea6600d458ec1a8a795fe2212b3d9f8e/vs_Community.exe
            toolset: V143
          - vcuda_full: 11.6.0
            vcuda: 11.6
            vs_url: https://download.visualstudio.microsoft.com/download/pr/6d7709aa-465b-4604-b797-3f9c1d911e67/c4cbd4106b2b6ebd5e88e75d025b0ecbea6600d458ec1a8a795fe2212b3d9f8e/vs_Community.exe
            toolset: V143
    steps:
      - name: Checkout
        uses: actions/checkout@v2
#      - name: Install Cuda
#        uses: Jimver/cuda-toolkit@v0.2.8
      - name: Install Visual Studio
        run: |
            Invoke-WebRequest -uri ${{ matrix.vs_url }} -outfile setup.exe
            .\setup.exe --layout temp --add Microsoft.VisualStudio.Workload.NativeDesktop
      - name: Activate Visual Studio shell
        uses: egor-tensin/vs-shell@v2
      - name: Build
        run:  |
          cd SPONGE
          ./vs_project_generator.bat ${{ matrix.vcuda }} ${{ matrix.toolset }}
          devenv SPONGE.sln /BUILD
          devenv SPONGE_NOPBC.sln /BUILD
          devenv SPONGE_FEP.sln /BUILD
          devenv SPONGE_TI.sln /BUILD
      - name: Upload
        uses: actions/upload-artifact@v3
        with:
          name: SPONGE_cuda11p7
          path: SPONGE\x64\Release\**.exe
