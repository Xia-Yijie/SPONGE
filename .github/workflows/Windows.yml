name: build SPONGE on Windows 
on:
  push

jobs:
  build:
    name: build-${{ matrix.vcuda }}
    runs-on: windows-2019
    strategy: 
      fail-fast: false
      matrix:
        include:
#          - vcuda_full: 11.7.0
#            vcuda: 11.7
#            toolset: V142
#          - vcuda_full: 11.6.0
#            vcuda: 11.6
#            toolset: V142
#          - vcuda_full: 11.5.0
#            vcuda: 11.5
#            toolset: V142
          - vcuda_full: 11.4.0
            vcuda: 11.4
            toolset: V142
          - vcuda_full: 11.3.0
            vcuda: 11.3
            toolset: V142
          - vcuda_full: 11.2.0
            vcuda: 11.2
            toolset: V142
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install Cuda
        uses: Jimver/cuda-toolkit@v0.2.8
        with:
          cuda: ${{ matrix.vcuda_full }}
      - name: Activate Visual Studio shell
        uses: egor-tensin/vs-shell@v2
      - name: Build
        run:  |
          cd SPONGE
          ./vs_project_generator.bat ${{ matrix.vcuda }} ${{ matrix.toolset }}
          devenv SPONGE.sln /BUILD
          devenv SPONGE_NOPBC.sln /BUILD
          devenv SPONGE_FEP.sln /BUILD
          devenv SPONGE_TI.sln /BUILD
      - name: Upload
        uses: actions/upload-artifact@v3
        with:
          name: SPONGE_cuda11p7
          path: SPONGE\x64\Release\**.exe
